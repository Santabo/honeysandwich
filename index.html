<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Honey Sandwich - AI Generated Music">
  <title>Honey Sandwich - AI Music</title>
  <style>
    body { font-family: Arial, sans-serif; background:#1e1e1e; color:#fff; text-align:center; margin:0; }
    header { background:#EBA937; padding:20px; font-size:32px; font-weight:600; }
    .container { max-width:900px; margin:20px auto; padding:30px; background:#2a2a2a; border-radius:12px; }
    h2 { color:#EBA937; }
    .music-list { list-style:none; padding:0; }
    .music-list li { display:flex; margin:20px 0; padding:20px; background:#3a3a3a; border-radius:12px; align-items:center; }
    .music-list img {
      width:160px;
      height:160px;
      border-radius:50%;
      margin-right:20px;
      object-fit:cover;
      background:#111;
      transform: rotate(0deg);
    }
    .music-info { text-align:left; flex-grow:1; }
    .music-info h3 { color:#EBA937; margin:10px 0; }
    .music-info audio { width:100%; max-width:320px; margin:15px 0; }
    .license-box {
      background:#444;
      padding:12px;
      border-radius:8px;
      font-size:14px;
      color:#ddd;
      margin-top:10px;
      line-height:1.5em;
    }
    .license-box a { color:#EBA937; text-decoration:none; }
    .license-box a:hover { text-decoration:underline; }
    .copyright { margin:30px 0; font-size:14px; color:#bbb; }
    @media(max-width:768px){
      .music-list li{flex-direction:column; text-align:center;}
      .music-list img{margin:0 0 15px 0;}
    }
  </style>
</head>
<body>
  <header>Honey Sandwich - AI Generated Music</header>
  <div class="container">
    <h2>Featured Music</h2>
    <ul id="music-list" class="music-list"><li>Loading music…</li></ul>
  </div>
  <div class="copyright">
    © 2025 Honey Sandwich. Please contact me on Discord for permission:
    <a href="https://discord.com/users/789872551731527690" target="_blank" rel="noopener">Discord Link</a>.
  </div>

  <script>
    const clientId = "02gUJC0hH2ct1EGOcYXQIzRFU91c72Ea"; // public SC web client_id
    const userURN = "soundcloud:users:1514835736"; // Honey Sandwich user

    async function loadProfile() {
      const api = `https://api-v2.soundcloud.com/profile/${userURN}?limit=20&linked_partitioning=1&client_id=${clientId}&app_version=170903&app_locale=en`;

      try {
        const res = await fetch(api, { cache: "no-store" });
        const json = await res.json();

        const list = document.getElementById("music-list");
        list.innerHTML = "";

        if (!json.collection || json.collection.length === 0) {
          list.innerHTML = "<li>⚠️ No music found.</li>";
          console.log("Profile response:", json);
          return;
        }

        function ccBox(songTitle, originalUrl) {
          return `
            <div class="license-box">
              This is a cover of EspiDev's song
              <em>'${songTitle}'</em> (<a href="${originalUrl}" target="_blank" rel="noopener">Original on SoundCloud</a>)<br><br>
              Licensed under Creative Commons:<br>
              You are free to copy, distribute, and transmit this work under the following conditions:<br>
              <strong>Attribution:</strong> You must give credit to the artist.<br><br>
              <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank" rel="noopener">Commons Deed</a> |
              <a href="https://creativecommons.org/licenses/by/3.0/legalcode" target="_blank" rel="noopener">Legal Code</a>
            </div>
          `;
        }

        function hsBox() {
          return `
            <div class="license-box">
              This is an original song by <strong>Honey Sandwich</strong>.<br><br>
              Licensed under Honey Sandwich Permissions:<br>
              – Redistribution is not allowed outside official platforms (SoundCloud, Spotify, TikTok, Shazam, YouTube Music, and official Honey Sandwich sites).<br>
              – No derivative works are allowed unless given explicit permission.<br>
              – Use for revenue purposes requires permission via Discord.<br><br>
              <a href="license.html" target="_blank" rel="noopener">Full License Details</a>
            </div>
          `;
        }

        json.collection.forEach(entry => {
          const track = entry.track || entry.playlist; // profile mixes tracks + playlists
          if (!track) return;

          const title = track.title || "Untitled";
          const titleLC = title.toLowerCase();
          const artwork = track.artwork_url ? track.artwork_url.replace("-large","-t500x500") : "https://via.placeholder.com/160";

          // Use progressive mp3 stream URL
          const audioUrl = track.media?.transcodings?.find(t => t.format?.protocol === "progressive")?.url + `?client_id=${clientId}` || "";

          let licenseBox;
          if (titleLC.includes("espidev") && titleLC.includes("forever")) {
            licenseBox = ccBox("Forever", "https://soundcloud.com/espidev/forever");
          } else if (titleLC.includes("espidev") && titleLC.includes("reverie")) {
            licenseBox = ccBox("Reverie", "https://soundcloud.com/espidev/reverie");
          } else {
            licenseBox = hsBox();
          }

          const li = document.createElement("li");
          li.innerHTML = `
            <img src="${artwork}" alt="Cover for ${title}">
            <div class="music-info">
              <h3>${title}</h3>
              ${audioUrl ? `
              <audio controls>
                <source src="${audioUrl}" type="audio/mpeg">
                Your browser does not support audio.
              </audio>` : `<p>⚠️ Stream not available</p>`}
              ${licenseBox}
            </div>
          `;
          list.appendChild(li);

          const audio = li.querySelector("audio");
          const cover = li.querySelector("img");
          if (audio) {
            let angle = 0;
            let spinning = false;
            function rotate() {
              if (spinning) {
                angle = (angle + 0.09) % 360;
                cover.style.transform = `rotate(${angle}deg)`;
                requestAnimationFrame(rotate);
              }
            }
            audio.addEventListener("play", () => {
              document.querySelectorAll("audio").forEach(a => { if (a !== audio) a.pause(); });
              spinning = true; rotate();
            });
            audio.addEventListener("pause", () => { spinning = false; });
            audio.addEventListener("ended", () => { spinning = false; });
          }
        });

      } catch (err) {
        console.error("Error loading profile:", err);
        document.getElementById("music-list").innerHTML = "<li>Failed to load music.</li>";
      }
    }

    loadProfile();
    setInterval(loadProfile, 5 * 60 * 1000);
  </script>
</body>
</html>
